;(function($) {
    $.fn.DB_tabMotionBanner = function(options) {
        var defaults = {
            key: "",
            autoRollingTime: 3000,
            bgSpeed: 1000,
            motion: ""
        };
        var options = $.extend(defaults,options);
        return this.each(function() {
            var t = $(this);
            var img = t.find(".DB_imgSet");
            var imgLi = t.find(".DB_imgSet li");
            var menu = t.find(".DB_menuSet");
            var menuLi = t.find(".DB_menuSet li");
            var bgLi = t.find(".DB_bgSet li");
            var next = t.find(".DB_next");
            var prev = t.find(".DB_prev");
            var len = imgLi.length;
            var p = 0;/*记录当前的位置*/
            var timer = null;
            main();
            function main() {
                setData();
                run();
                autoRun();
            }
            /*setData*/
            function setData() {
                img.css({
                    position: "relative"
                });
                imgLi.css({
                    position: "absolute"
                });
                for (var i = 0; i < len; i++) {
                    if (i == p) {
                        imgLi.eq(i).show();
                    } else {
                        imgLi.eq(i).hide();
                    }
                }
                for (var i = 0; i < len; i++) {
                    var x = imgLi.eq(i).find("img");
                    for (var w = 0; w < x.length; w++) {
                        var A = x.eq(w);
                        var v = options.motion[A.attr("class")];
                        if (v != null) {
//                            console.log(Number(A.css("left").split("px"))[0]);
                            var l = Number(A.css("left").split("px")[0]);
//                            console.log(z)
                            var t = Number(A.css("top").split("px")[0]);
//                            console.log(v.left)
                            A.data({
                                x2: l,
                                y2: t,
                                x1: l + v.left,
                                y1: t + v.top,
                                opacity: v.opacity,
                                speed: v.speed,
                                delay: v.delay == null ? 0 : v.delay
                            })
                        }
                    }
                }
            }
            /*setData End*/
            /*run*/
            function run() {
                t.bind("mouseenter",
                function() {
                    clearInterval(timer);
                    next.show();
                    prev.show()
                });
                t.bind("mouseleave",
                function() {
                    autoRun();
                    next.hide();
                    prev.hide()
                });
                menuLi.bind("click",function() {
                    if ($(this).index() != p) {
                        p = $(this).index();
                        animate()
                    }
                });
                next.bind("click",function() {
                    nextAnimate()
                });
                prev.bind("click",function() {
                    p = p--%len;
                    animate()
                })
            }
            /*run End*/
            /*next*/
            function nextAnimate() {
                p = ++p % len;
                animate()
            }
            /*next End*/
            function autoRun() {
                timer = setInterval(nextAnimate,options.autoRollingTime)
            }
            /*animate*/
            function animate() {
                for (var z = 0; z < imgLi.length; z++) {
                    var A = imgLi.eq(z);
                    var y = bgLi.eq(z);
                    if (p == z) {
                        A.show();
                        var x = A.find("img");
                        for (var w = 0; w < x.length; w++) {
                            var A = x.eq(w);
                            var v = options.motion[A.attr("class")];
                            if (v != null) {
//                                if (A.attr("src").indexOf(".png") > 0 && a.browser.msie && a.browser.version < 9) {
//                                    A.css({
//                                        left: A.data("x1"),
//                                        top: A.data("y1"),
//                                        opacity: 1,
//                                        display: "none"
//                                    })
//                                } else {
                                    A.css({
                                        left: A.data("x1"),
                                        top: A.data("y1"),
                                        opacity: A.data("opacity")
                                    })
//                                }
                                A.stop().delay(A.data("delay")).queue(function() {
                                    $(this).css("display", "block");
                                    $(this).dequeue()
                                }).animate({
                                    left: A.data("x2"),
                                    top: A.data("y2"),
                                    opacity: 1
                                },
                                A.data("speed"))
                            }
                        }
//                        n(menuLi.eq(z).find("img"), "src", "_off", "_on");
                        menuLi.eq(z).addClass("select");
                        y.stop(true, true).fadeIn(options.bgSpeed);
                    } else {
                        A.hide();
//                        n(menuLi.eq(z).find("img"), "src", "_on", "_off");
                        menuLi.eq(z).removeClass("select");
                        y.stop(true, true) .fadeOut(options.bgSpeed);
                    }
                }
            }
            /*animate End*/

            /*function n(w, z, v, x) {
                var y = w.attr(z);
                if (String(y).search(v) != -1) {
                    w.attr(z, y.replace(v, x))
                }
            }*/
        })
    }
})(jQuery);